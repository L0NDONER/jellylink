services:
  jellylink:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: jellylink
    restart: unless-stopped

    # Matches your host user 'martin' (UID 1000)
    user: "1000:1000"
    environment:
      - PYTHONUNBUFFERED=1

    working_dir: /app

    volumes:
      # THE SPEED FIX:
      # Map the entire media root. Move your 'downloads' folder here 
      # on the host (mv /data/downloads /media/downloads).
      - /media:/media:rw
      
      # The project directory where jellylink.conf and jellylink.db live.
      # If processed.db is in the downloads folder, it will be found 
      # under /media/downloads/processed.db.
      - .:/app:rw

    read_only: false
    tmpfs:
      - /tmp

########## EXPLANATION ##########
# 1. Database Persistence: Jellylink uses 'jellylink.db' in the /app 
#    folder and looks for 'processed.db' in the watch directory. 
#    By mounting '.' to '/app', your primary DB stays safe.
# 2. Migration Step: You must move 'processed.db' from '/data/downloads' 
#    to '/media/downloads' on the host so Jellylink recognizes it 
#    after the path change.
# 3. Path Logic: Within your jellylink.conf, you will change the 
#    watch_dir to '/media/downloads'.
